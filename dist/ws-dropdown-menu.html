<!-- inject:global -->
<!-- endinject -->
<dom-module id="ws-dropdown-menu">
    <template>
        <!-- inject:html -->
        <content id="menu"></content>
<template is="dom-if" if="{{hasItems}}">
    <ul class$="[[menuClass]]">
        <template is="dom-if" if="{{isNotRendered()}}">{{attached()}}</template>
        <template is="dom-if" if="{{filterable}}">
            <li class="dropdown-filter">
                <input type="text" value="{{filter}}" on-keyup="filterItems" on-change="preventChange" />
            </li>
        </template>
        <!-- Back button with separator -->
        <template is="dom-if" if="{{hasParent}}">
            <li class="dropdown-item" on-click="back">
                <a class="text back" href$="[[parent.href]]">
                    <i class="icon">&lsaquo;</i>
                    [[getItemLabel(parent)]]
                </a>
            </li>
            <li class="dropdown-item-separator"></li>
        </template>
        <!-- Selected item list -->
        <template is="dom-if" if="{{hasValue}}">
            <template is="dom-repeat" items="[[value]]" on-dom-change="itemsChanged">
                <li class="dropdown-item" on-click="next" item="[[item]]" stored>
                    <a class$="[[getItemAnchorClass(item.*)]]" href$="[[item.href]]">
                        <template is="dom-if" if="[[item.icon]]">
                            <i class$="[[getItemIconClass(item.icon)]]"></i>
                        </template>
                        [[getItemLabel(item)]]
                    </a>
                </li>
            </template>
            <li class="dropdown-item-separator"></li>
        </template>
        <!-- Item list -->
        <template is="dom-repeat"
                  items="[[items]]"
                  on-dom-change="itemsChanged"
                  filter="getVisibleItems"
                  observe="stored filtered"
                  rendered-item-count="{{itemsRendered}}">
            <template is="dom-if" if="[[limitNotReached(index)]]">
                <li class="dropdown-item" on-click="next" item="[[item]]">
                    <a class$="[[getItemAnchorClass(item.*)]]" href$="[[item.href]]">
                        <template is="dom-if" if="[[item.icon]]">
                            <i class$="[[getItemIconClass(item.icon)]]"></i>
                        </template>
                        [[getItemLabel(item)]]
                    </a>
                    <template is="dom-if" if="[[item.children]]">
                        <ws-dropdown-menu items="[[item.children]]" parent="[[item]]"></ws-dropdown-menu>
                    </template>
                </li>
            </template>
        </template>
        <template is="dom-if" if="{{!itemsRendered}}">
            <li class="dropdown-item">
                <a class="text is-disabled">No results found</a>
            </li>
        </template>
        <!-- Submit button -->
        <template is="dom-if" if="{{multiple}}">
            <li class="dropdown-submit">
                <button on-click="submit">OK</button>
            </li>
        </template>
    </ul>
</template>
        <!-- endinject -->
        <style>
            /* inject:styles */
            /* endinject */
        </style>
    </template>

    <script>
    (function(){
        /* inject:js */
        "use strict";var ANIMATION_START_EVENTS=["oAnimationStart","MSAnimationStart","animationstart"],ANIMATION_END_EVENTS=["oAnimationEnd","MSAnimationEnd","animationend"];Polymer({is:"ws-dropdown-menu",properties:{parent:{type:Object,value:null},items:{type:Array},value:{type:Array,value:[]},multiple:{type:Boolean,value:!1},limit:{type:Number,value:10},filterable:{type:Boolean,value:!1},filter:{type:String},hasValue:{type:Boolean,computed:"valueNotEmpty(value)"},hasParent:{type:Boolean,computed:"isChildMenu(parent)"},hasItems:{type:Boolean,computed:"itemsAreBound(items)"},menuClass:{type:String,computed:"getMenuClass(parent)"}},getHeight:function(){return this.menuContainer.clientHeight},isNotRendered:function(){return!this.menuContainer},isChildMenu:function(t){return!!t},valueNotEmpty:function(t){return t&&t.length},itemsAreBound:function(t){return!!t},getVisibleItems:function(t){return!t.stored&&!t.filtered},limitNotReached:function(t){return t<this.limit},getMenuClass:function(t){return"dropdown-menu "+(t?"":"dropdown-root-menu")},getItemLabel:function(t){return t.label||t},getItemIconClass:function(t){return"icon "+t},getItemAnchorClass:function(t){var e=t.base;return"text "+(e.selected?"is-active":e.focused?"is-focused":"")},filterItems:function(t){for(var e=this,n=new RegExp(t.target.value,"i"),i=this.items.length;i--;)this.items[i].label.match(n)?this.set("items."+i+".filtered",!1):this.set("items."+i+".filtered",!0);setTimeout(function(){return e.itemsChanged()},0)},itemsChanged:function(){this.menuContainer&&this.fire("change-size",{height:this.getHeight()})},attached:function(){this.grabElements(),this.setupListeners()},grabElements:function(){this.menuContainer=this.$$(".dropdown-menu"),this.menuContainer||(this.distributedNodes=Array.from(Polymer.dom(this.$.menu).getDistributedNodes()),this.projection=this.distributedNodes.find(function(t){return 1===t.nodeType&&t.classList.contains("dropdown-menu")}),this.projection&&(this.menuContainer=this.projection),!this.menuContainer&&!this.items)},setupListeners:function(){var t=this;this.menuContainer&&(this.menuContainer.addEventListener("click",function(e){t.projection||e.stopPropagation()}),this.menuContainer.addEventListener("go-back",function(e){e.stopPropagation(),t.showParent()},!0))},clearSelections:function(){if(this.items)for(var t=0;t<this.items.length;t++)this.items[t].selected&&!this.items[t].stored&&this.set("items."+t+".selected",!1)},submit:function(){for(var t=this,e=[],n=0;n<this.items.length;n++)this.items[n].selected?(this.set("items."+n+".stored",!0),e.push(this.items[n])):this.items[n].stored&&this.set("items."+n+".stored",!1);this.propagate("change",e),setTimeout(function(){return t.set("value",e)},10)},next:function(t){var e=t.currentTarget.hasAttribute("stored")?"value":"items",n=t.currentTarget.item,i=this[e].indexOf(n);return n.children&&n.children.length?this.showChild(t.currentTarget.querySelector("ws-dropdown-menu")):n?this.multiple?this.set(e+"."+i+".selected",!n.selected):(this.clearSelections(),this.set(e+"."+i+".selected",!n.selected),this.propagate("change",n)):this.propagate("click",n),!1},back:function(){this.propagate("go-back")},close:function(){this.menuContainer.classList.remove("mod-sub-open","mod-menu-open"),this.openSubMenu&&this.openSubMenu.close()},showChild:function(t){this.openSubMenu=t,this.propagate("change-size",{height:t.getHeight()}),this.animateOut(),t.animateIn()},showParent:function(){this.openSubMenu&&(this.propagate("change-size",{height:this.getHeight()}),this.openSubMenu.animateOut(!0),this.animateIn(!0),this.openSubMenu=null)},animateIn:function(t){this.isOpen=!0;var e=t?"animate-in":"animate-sub-in";this.animateElement(this.menuContainer,e,function(t){t.classList.remove("mod-sub-open"),t.classList.add("mod-menu-open")})},animateOut:function(t){this.isOpen=!1;var e=t?"animate-sub-out":"animate-out";this.animateElement(this.menuContainer,e,function(e){e.classList.remove("mod-menu-open"),t||e.classList.add("mod-sub-open")})},animateElement:function(t,e,n){var i=0,s=function y(s){if(!--i){var o=!0,r=!1,a=void 0;try{for(var u,h=ANIMATION_END_EVENTS[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var m=u.value;t.removeEventListener(m,y)}}catch(l){r=!0,a=l}finally{try{!o&&h["return"]&&h["return"]()}finally{if(r)throw a}}t.classList.remove(e),n(t)}},o=!0,r=!1,a=void 0;try{for(var u,h=ANIMATION_END_EVENTS[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var m=u.value;t.addEventListener(m,s)}}catch(l){r=!0,a=l}finally{try{!o&&h["return"]&&h["return"]()}finally{if(r)throw a}}var c=!0,d=!1,p=void 0;try{for(var f,g=ANIMATION_START_EVENTS[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var v=f.value;t.addEventListener(v,function(){return i++})}}catch(l){d=!0,p=l}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw p}}t.classList.add(e)},propagate:function(t,e){this.fire(t,e)},preventChange:function(t){t.preventDefault(),t.stopPropagation()}});
        /* endinject */
    })()
    </script>
</dom-module>
